<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#6c5ce7">
    <title>Happy Habits - My Tasks</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸ® My Happy Habits</div>
            <div class="user-info">
                <span id="child-name">Hey there!</span>
                <button class="btn btn-secondary" onclick="logout()">Switch Kid</button>
            </div>
        </div>

        <!-- Child Stats Card -->
        <div class="card" style="background: linear-gradient(135deg, #ff9a9e, #fecfef); color: white;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 id="welcome-message" style="margin-bottom: 10px;">Welcome back!</h2>
                    <p style="opacity: 0.9;">Let's complete some tasks today!</p>
                    <div id="today-progress" style="margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>Today's Progress:</span>
                            <div class="progress-bar" style="flex: 1; height: 10px; background: rgba(255,255,255,0.3); border-radius: 5px; overflow: hidden;">
                                <div id="today-progress-fill" style="height: 100%; background: #00b894; width: 0%; transition: width 0.5s ease;"></div>
                            </div>
                            <span id="today-percentage">0%</span>
                        </div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">ğŸ†</div>
                    <div id="child-stats" class="child-stats">
                        <div class="stat">
                            <div class="stat-number" id="balance">0</div>
                            <div class="stat-label">COINS</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="streak">0</div>
                            <div class="stat-label">STREAK</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Visualization -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ“Š My Progress</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="showWeeklyChart()">ğŸ“ˆ Weekly</button>
                    <button class="btn btn-secondary" onclick="showStreakCalendar()">ğŸ“… Calendar</button>
                </div>
            </div>
            
            <!-- Weekly Progress Chart -->
            <div id="weekly-progress" class="progress-section">
                <h3 style="margin-bottom: 20px;">ğŸ“ˆ Weekly Progress (Last 30 Days)</h3>
                <div id="weekly-chart" class="chart-container">
                    <div class="loading">Loading your progress...</div>
                </div>
                <div id="weekly-stats" class="stats-summary"></div>
            </div>
            
            <!-- Streak Calendar -->
            <div id="streak-calendar" class="progress-section" style="display: none;">
                <h3 style="margin-bottom: 20px;">ğŸ“… Streak Calendar (Last 60 Days)</h3>
                <div id="calendar-container" class="calendar-grid">
                    <div class="loading">Loading your calendar...</div>
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ddd;"></div>
                        <span>No tasks</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffeb3b;"></div>
                        <span>Some completed</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4caf50;"></div>
                        <span>All completed</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Today's Tasks -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ“‹ Today's Tasks</h2>
                <button class="btn btn-primary" onclick="refreshTasks()">ğŸ”„ Refresh</button>
            </div>
            <div id="tasks-content" class="loading">Loading your awesome tasks...</div>
        </div>

        <!-- Completed Tasks Today -->
        <div class="card" id="completed-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">âœ… Completed Today</h2>
            </div>
            <div id="completed-content"></div>
        </div>
        
        <!-- Bills Section -->
        <div class="card" style="background: linear-gradient(135deg, #e17055, #ff7675); color: white;">
            <div class="card-header" style="border-color: rgba(255, 255, 255, 0.2);">
                <h2 class="card-title">ğŸ’³ My Bills</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3);" onclick="refreshBills()">ğŸ”„ Refresh</button>
                    <button class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3);" onclick="showBillHistory()">ğŸ“‹ History</button>
                </div>
            </div>
            <div id="bills-content" class="loading" style="color: white;">Loading your bills...</div>
        </div>

        <!-- Bill Payment History -->
        <div class="card" id="bill-history-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">ğŸ“‹ Bill Payment History</h2>
                <button class="btn btn-secondary" onclick="hideBillHistory()">â† Back to Bills</button>
            </div>
            <div id="bill-history-content" class="loading">Loading...</div>
        </div>

        <!-- Reward Store -->
        <div class="card" style="background: linear-gradient(135deg, #fd79a8, #fdcb6e); color: white;">
            <div class="card-header" style="border-color: rgba(255, 255, 255, 0.2);">
                <h2 class="card-title">ğŸª Reward Store</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="store-tab-btn" class="btn active-store-tab" style="background: rgba(255, 255, 255, 0.3); color: white; border: 2px solid rgba(255, 255, 255, 0.4);" onclick="showStoreTab()">ğŸª Store</button>
                    <button id="wishlist-tab-btn" class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3);" onclick="showWishlistTab()">â­ Wishlist</button>
                    <button class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3);" onclick="refreshStore()">ğŸ”„ Refresh</button>
                    <button class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3);" onclick="showMyPurchases()">ğŸ“¦ My Orders</button>
                </div>
            </div>
            <div id="store-content" class="loading" style="color: white;">Loading awesome rewards...</div>
            <div id="wishlist-content" style="display: none; color: white;">
                <div class="loading">Loading your wishlist...</div>
            </div>
        </div>
        
        <!-- My Purchases -->
        <div class="card" id="purchases-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">ğŸ“¦ My Purchases</h2>
                <button class="btn btn-secondary" onclick="hidePurchases()">â† Back to Store</button>
            </div>
            <div id="purchases-content" class="loading">Loading...</div>
        </div>
    </div>

    <!-- Photo Upload Modal -->
    <div id="photo-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“¸ Add Photo Proof (Optional)</h3>
                <button class="close" onclick="closePhotoModal()">&times;</button>
            </div>
            <form id="photo-form">
                <div class="form-group">
                    <label for="task-photo">Take a photo to show you completed the task!</label>
                    <input type="file" id="task-photo" accept="image/*" capture="camera" class="form-control">
                    <small style="color: #636e72; margin-top: 5px; display: block;">
                        ğŸ“± Tip: You can take a photo with your camera or choose from your photos
                    </small>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="submitWithoutPhoto()" style="flex: 1;">
                        Skip Photo
                    </button>
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ğŸ“¸ Submit with Photo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Purchase Confirmation Modal -->
    <div id="purchase-modal" class="modal">
        <div class="modal-content" style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; max-width: 400px;">
            <div class="modal-header" style="border-color: rgba(255,255,255,0.2);">
                <h3>ğŸ›’ Confirm Purchase</h3>
                <button class="close" onclick="closePurchaseModal()" style="color: white;">&times;</button>
            </div>
            <div id="purchase-details" class="purchase-details">
                <!-- Purchase details will be filled by JavaScript -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closePurchaseModal()" style="flex: 1; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">
                    Cancel
                </button>
                <button id="confirm-purchase-btn" class="btn btn-success" style="flex: 1; background: #00b894;">
                    âœ… Buy Now!
                </button>
            </div>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div id="celebration-modal" class="modal">
        <div class="modal-content" style="text-align: center; background: linear-gradient(135deg, #fdcb6e, #e17055);">
            <div style="font-size: 80px; margin: 20px 0;">ğŸ‰</div>
            <h2 style="color: white; margin-bottom: 20px;">Awesome Job!</h2>
            <p style="color: white; font-size: 18px; margin-bottom: 30px;" id="celebration-message">
                Task submitted! Your parent will review it soon.
            </p>
            <button class="btn btn-primary" onclick="closeCelebrationModal()" style="background: white; color: #e17055;">
                Keep Going! ğŸ’ª
            </button>
        </div>
    </div>

    <script src="/js/child-dashboard.js"></script>
</body>
</html>